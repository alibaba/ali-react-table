import { Meta, Story, Preview } from '@storybook/addon-docs/blocks'
import LinkTo from '@storybook/addon-links/react'

<Meta title="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / æ–‡æ¡£" />

# è¡¨æ ¼åŠŸèƒ½æ‹“å±•

ali-react-table/biz æä¾›äº†ä¸šåŠ¡å¼€å‘ä¸­ç»å¸¸éœ€è¦ç”¨åˆ°çš„ä¸€äº›åŠŸèƒ½ï¼Œéƒ¨åˆ†åŠŸèƒ½é‡‡ç”¨ **ç»Ÿä¸€çš„æ‹“å±•æœºåˆ¶** è¿›è¡Œå®ç°ä¸æä¾›ï¼Œå…¶ä»–åŠŸèƒ½ç”±å¯¼å‡ºå‡½æ•° / React ç»„ä»¶ / React hooks è¿›è¡Œæä¾›ã€‚

ali-react-table/biz æä¾›çš„å¸¸ç”¨åŠŸèƒ½å¦‚ä¸‹ï¼š

- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / æ ‘çŠ¶æ¨¡å¼" story="page">
    æ ‘çŠ¶æ¨¡å¼
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / æ’åº" story="page">
    æ’åº
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / åˆ—é«˜äº®" story="page">
    åˆ—é«˜äº®
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / å•å…ƒæ ¼è‡ªåŠ¨åˆå¹¶" story="page">
    å•å…ƒæ ¼è‡ªåŠ¨åˆå¹¶
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / æ‹–æ‹½è°ƒæ•´åˆ—å®½" story="page">
    æ‹–æ‹½è°ƒæ•´åˆ—å®½
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / å¸¸ç”¨åŠŸèƒ½ / å…¶ä»–åŠŸèƒ½" story="page">
    commonTransforms ä¸­çš„å…¶ä»–åŠŸèƒ½
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / hooks / è¡¨æ ¼æ“ä½œæ " story="page">
    hooksï¼šè¡¨æ ¼æ“ä½œæ ï¼ˆåŒ…æ‹¬è‡ªå®šåˆ—åŠŸèƒ½ï¼‰
  </LinkTo>
- <LinkTo kind="è¡¨æ ¼åŠŸèƒ½æ‹“å±• / reactç»„ä»¶ / è‡ªå®šä¹‰åˆ—å¯¹è¯æ¡†" story="page">
    React ç»„ä»¶ï¼šè‡ªå®šä¹‰åˆ—å¯¹è¯æ¡†
  </LinkTo>

## ç»Ÿä¸€æ‹“å±•æœºåˆ¶

`BaseTable` åŸºäº dataSource å’Œ column æ¸²æŸ“è¡¨æ ¼ï¼Œå¯¹ dataSource/columns è¿›è¡Œä¸€äº›åŒ…è£…å’Œæ›¿æ¢ï¼Œå¯ä»¥å®ç°ä¸°å¯Œçš„è¡¨æ ¼ç‰¹æ€§ï¼šåŒ…æ‹¬æ’åºã€æ ‘çŠ¶æ¨¡å¼ã€è¿‡æ»¤ç­‰ã€‚

ali-react-table/biz åŸºäº `TableTransform` æ¥å¯¹ BaseTable è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚`Transform<T>` ä¸ `TableTransform` çš„æ¥å£å¦‚ä¸‹ï¼š

```typescript
type Transform<T> = (input: T) => T

type TableTransform = Transform<{
  columns: ArtColumn[]
  dataSource: any[]
}>
```

`TableTransform`ï¼ˆåé¢ç®€ç§° transformï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è½¬æ¢å‡½æ•°ï¼Œè¾“å…¥**_åˆ—é…ç½® + æ•°æ®æº_**ï¼Œè¾“å‡ºä¸€ä»½æ–°çš„**_åˆ—é…ç½® + æ•°æ®æº_**ã€‚æ¯ä¸€ä¸ª transform é€šè¿‡å¯¹ dataSource/columns çš„åŒ…è£…æˆ–æ›´æ–°ä»¥å®ç°ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œä¾‹å¦‚è°ƒæ•´åˆ—çš„æ˜¾ç¤ºæˆ–éšè—ï¼Œä¸ºæŸä¸€è¡Œæ•°æ®è®¡ç®—ç¼©è¿›ï¼Œæ·»åŠ æ’åºåŠŸèƒ½ç­‰.

æ¯ä¸ª transform çš„è¾“å…¥å’Œè¾“å‡ºçš„ç±»å‹ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å°†å¤šä¸ª transform ç»„åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå¤§çš„ transformï¼Œä»è€Œå®ç°ä¸åŒåŠŸèƒ½çš„ç»„åˆã€‚

## ä½¿ç”¨ transform

ali-react-table/biz å¯¼å‡ºäº† applyTransforms æ–¹æ³•æ¥åº”ç”¨å¤šä¸ª transform ğŸŒŸï¼š

```jsx
import { BaseTable } from 'ali-react-table'
// æ³¨æ„å¯¼å…¥çš„è·¯å¾„
import { applyTransforms } from 'ali-react-table/biz'

const renderData = applyTransforms(
  // è¾“å…¥æ”¾åœ¨ç¬¬ä¸€ä¸ªå‚æ•°
  { columns: inputColumns, dataSource: inputDataSource },
  // transforms ä½œä¸ºåç»­çš„å‚æ•°
  transform1,
  transform2,
  transform3,
  ...moreTransforms,
)

return <BaseTable dataSource={renderData.dataSource} columns={renderData.columns} />
```

applyTransforms åªæ˜¯ä¸€ä¸ªç®€å•çš„è¾…åŠ©å‡½æ•°ï¼ŒèƒŒåçš„é€»è¾‘å¦‚ä¸‹ï¼š

```javascript
const output = applyTransforms(input, transform_1, transform_2, transform_3)

// ä¸Šé¢çš„ä»£ç ç›¸å½“äºä»¥ä¸‹ä»£ç ï¼š
const temp1 = transform_1(input)
const temp2 = transform_2(temp1)
const output = transform_3(temp2)
```

## è‡ªå®šä¹‰ transform

é™¤äº† commonTransforms ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç° transformï¼Œç„¶åå°†å…¶ä¸å…¶ä»– transform ç»„åˆåˆ°ä¸€èµ·ã€‚

```javascript
function doubleDataSourceTransform({ columns, dataSource }) {
  const outputColumns = columns

  const outputDataSource = dataSource.concat(dataSource)

  return { columns: outputColumns, dataSource: outputDataSource }
}
```

ä½ å¯ä»¥åœ¨è‡ªå®šä¹‰çš„ transform ä¸­æ‰§è¡Œä»»ä½•é€»è¾‘ï¼Œåªè¦è¿”å›å€¼ä»ç„¶æ˜¯æœ‰æ•ˆçš„ `dataSource / columns` å³å¯ã€‚åœ¨è‡ªå®šä¹‰çš„ transform ä¸­ï¼Œå¯¹æ¯ä¸€ä¸ªåˆ—çš„å¤„ç†æ–¹å¼å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œæ­¤æ—¶æˆ‘ä»¬æ¨èåˆ©ç”¨ `column.features` æ¥ä¸ºä¸åŒçš„åˆ—æ‰“ä¸Šæ ‡è®°ã€‚

## è‡ªå®šä¹‰ transform è¾…åŠ©å‡½æ•° `traverseColumn`

å®ç°è‡ªå®šä¹‰ transform éœ€è¦æ³¨æ„ column æ˜¯æ ‘çŠ¶ç»“æ„ï¼ˆ`column.children` å­˜æ”¾äº†å­èŠ‚ç‚¹ï¼‰ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¯¹ column è¿›è¡Œé€’å½’çš„å¤„ç†ã€‚ä¸ºæ­¤ ali-react-table/biz æä¾›äº† `traverseColumn` æ–¹æ³•ç”¨æ¥ç®€åŒ–åˆ›å»ºé’ˆå¯¹åˆ—çš„ transformã€‚æä¾›ä¸€ä¸ªé’ˆå¯¹å•ä¸ª column é…ç½®çš„è½¬æ¢å‡½æ•°ï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”Ÿæˆå¯¹åº”çš„ TableTransformï¼Œæ¥å£å¦‚ä¸‹ï¼š

```typescript
function traverseColumn(fn: (column: ArtColumn) => null | ArtColumn | ArtColumn[]): TableTransform
```

è¿”å› `null` æ—¶ï¼Œå¯¹åº”çš„åˆ—å°†è¢«ç§»é™¤ï¼›è¿”å› `ArtColumn` æˆ–ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œè¿”å›çš„ç»“æœä¼šæ›¿æ¢å¯¹åº”çš„åˆ—ã€‚

ä¸‹é¢æ˜¯ä¸€äº›åˆ©ç”¨ `traverseColumn` å®ç°çš„ transformï¼š

```javascript
// åè½¬åˆ—çš„ hidden å±æ€§
const invertHidden = traverseColumn((col) => ({ ...col, hidden: !col.hidden }))

// å°†æ‰€æœ‰çš„åˆ—çš„æ ‡é¢˜å­—ä½“å¤§å°è®¾ç½®ä¸º 24px
const bigTitle = traverseColumn((col) => {
  const title = col.title ?? col.name
  return {
    ...col,
    title: <div style={{ fontSize: 24 }}>{title}</div>,
  }
})

// æ ¹æ® features.showCompare æ¥æ·»åŠ å¯¹åº”çš„ å¯¹æ¯”åˆ—
const addCompareCol = traverseColumn((col) => {
  if (col.features?.showCompare) {
    return [col, { ...col, name: 'å¯¹æ¯”å€¼', code: `compare_${col.code}` }]
  }
  return col
})
```

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒcommonTransforms ä¸­çš„å¤§éƒ¨åˆ† transform éƒ½æ˜¯é€šè¿‡è¯¥æ–¹æ³•ç”Ÿæˆçš„ã€‚
